<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Texas Aerial Robotics Documentation: Control API Usage</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Texas Aerial Robotics Documentation
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__home_eric_catkin_ws_src_Mission8_OutOfControls_api_doc.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Control API Usage </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>/ref control_functions</p>
<p>The Texas Aerial Robotics control API is designed to simplify the process of writing intelligent drone applications. The API is built off of mavros and mavlink. These two packages are middle men between the arducopter flight code on the pixhawk and our code on the jetson.</p>
<h2>List of functions.</h2>
<h3><a class="el" href="group__control__functions.html#gab90a45d8b081ba329b9d0f886adbc2d5">set_destination(float x, float y, float z, float psi)</a></h3>
<p>This function is used to command the drone to fly to a waypoint. These waypoints should be specified in the local reference frame. This is typically defined from the location the drone is launched. Psi is counter clockwise rotation following the drone’s reference frame defined by the x axis through the right side of the drone with the y axis through the front of the drone.</p>
<p>#### returns </p><div class="fragment"><div class="line">n/a</div></div><!-- fragment --> <h3><a class="el" href="group__control__functions.html#ga92292bc0da7dd2a58edf8e9aa10eb682">set_heading(float psi)</a></h3>
<p>This function is used to specify the drone’s heading in the local reference frame. Psi is counter clockwise rotation following the drone’s reference frame defined by the x axis through the right side of the drone with the y axis through the front of the drone.</p>
<p>#### returns </p><div class="fragment"><div class="line">n/a</div></div><!-- fragment --> <h3><a class="el" href="group__control__functions.html#ga1921a30d419eb397f7e40875217b45d1">wait4connect()</a></h3>
<p>Wait for connect is a function that will hold the program until communication with the FCU is established.</p>
<p>#### returns </p><div class="fragment"><div class="line">0 - connected to fcu </div><div class="line">-1 - failed to connect to drone</div></div><!-- fragment --> <h3><a class="el" href="group__control__functions.html#gab6fe46f505ab9804b4ed98b96286a811">wait4start()</a></h3>
<p>Wait for strat will hold the program until the user signals the FCU to enther mode guided. This is typically done from a switch on the safety pilot’s remote or from the ground control station.</p>
<p>#### returns </p><div class="fragment"><div class="line">0 - mission started</div><div class="line">-1 - failed to start mission</div></div><!-- fragment --> <h3><a class="el" href="group__control__functions.html#ga2a1100bb15673a9322c5be3bb8e9999f">initialize_local_frame()</a></h3>
<p>This function will create a local reference frame based on the starting location of the drone. This is typically done right before takeoff. This reference frame is what all of the the set destination commands will be in reference to.</p>
<h4>returns</h4>
<p>0 - frame initialized</p>
<h3><a class="el" href="group__control__functions.html#gac0aa671c99c09687515ec5bb8891c7d2">takeoff(float height)</a></h3>
<p>The takeoff function will arm the drone and put the drone in a hover above the initial position.</p>
<p>#### returns </p><div class="fragment"><div class="line">0 - nominal takeoff </div><div class="line">-1 - failed to arm </div><div class="line">-2 - failed to takeoff</div></div><!-- fragment --> <h3><a class="el" href="group__control__functions.html#ga54abc3f6eae022a8710bc0c2e1c54fbe">check_waypoint_reached()</a></h3>
<p>This function returns an int of 1 or 0. THis function can be used to check when to request the next waypoint in the mission.</p>
<p>#### returns </p><div class="fragment"><div class="line">1 - waypoint reached</div><div class="line">0 - waypoint not reached</div></div><!-- fragment --> <h3><a class="el" href="group__control__functions.html#ga52a11a139e56315de52d2ab439b0d203">land()</a></h3>
<p>this function changes the mode of the drone to land</p>
<p>#### returns </p><div class="fragment"><div class="line">1 - mode change successful</div><div class="line">0 - mode change not successful</div></div><!-- fragment --> <h3><a class="el" href="group__control__functions.html#gae693b071b5392f9253cdfc1f4f362fcc">init_publisher_subscriber(ros::NodeHandle nh)</a></h3>
<p>This function is called at the beginning of a program and will start of the communication links to the FCU. The function requires the program's ros nodehandle as an input</p>
<p>#### returns </p><div class="fragment"><div class="line">n/a</div></div><!-- fragment --> <h2>List of Structures</h2>
<p>### <a class="el" href="structcontrol__api__waypoint.html">control_api_waypoint</a> </p><div class="fragment"><div class="line">float x</div><div class="line">float y</div><div class="line">float z</div><div class="line">float psi</div></div><!-- fragment --><h2>Example Code</h2>
<p><a class="el" href="controlAPIExample_8cpp.html">src/controlAPIExample.cpp</a></p>
<div class="fragment"><div class="line">#include &lt;control_functions.hpp&gt;</div><div class="line">//include API </div><div class="line"></div><div class="line">int main(int argc, char** argv)</div><div class="line">{</div><div class="line">    //initialize ros </div><div class="line">    ros::init(argc, argv, &quot;offb_node&quot;);</div><div class="line">    ros::NodeHandle controlnode;</div><div class="line">    </div><div class="line">    //initialize control publisher/subscribers</div><div class="line">    init_publisher_subscriber(controlnode);</div><div class="line"></div><div class="line">    //specify some waypoints </div><div class="line">    std::vector&lt;control_api_waypoint&gt; waypointList;</div><div class="line">    control_api_waypoint nextWayPoint;</div><div class="line">    nextWayPoint.x = 0;</div><div class="line">    nextWayPoint.y = 0;</div><div class="line">    nextWayPoint.z = 3;</div><div class="line">    nextWayPoint.psi = 0;</div><div class="line">    waypointList.push_back(nextWayPoint);</div><div class="line">    nextWayPoint.x = 5;</div><div class="line">    nextWayPoint.y = 0;</div><div class="line">    nextWayPoint.z = 3;</div><div class="line">    nextWayPoint.psi = -90;</div><div class="line">    waypointList.push_back(nextWayPoint);</div><div class="line">    nextWayPoint.x = 5;</div><div class="line">    nextWayPoint.y = 5;</div><div class="line">    nextWayPoint.z = 3;</div><div class="line">    nextWayPoint.psi = 0;</div><div class="line">    waypointList.push_back(nextWayPoint);</div><div class="line">    nextWayPoint.x = 0;</div><div class="line">    nextWayPoint.y = 5;</div><div class="line">    nextWayPoint.z = 3;</div><div class="line">    nextWayPoint.psi = 90;</div><div class="line">    waypointList.push_back(nextWayPoint);</div><div class="line">    nextWayPoint.x = 0;</div><div class="line">    nextWayPoint.y = 0;</div><div class="line">    nextWayPoint.z = 3;</div><div class="line">    nextWayPoint.psi = 180;</div><div class="line">    waypointList.push_back(nextWayPoint);</div><div class="line"></div><div class="line">    // wait for FCU connection</div><div class="line">    wait4connect();</div><div class="line"></div><div class="line">    //wait for used to switch to mode GUIDED</div><div class="line">    wait4start();</div><div class="line"></div><div class="line">    //create local reference frame </div><div class="line">    initialize_local_frame();</div><div class="line"></div><div class="line">    //request takeoff</div><div class="line">    takeoff(3);</div><div class="line"></div><div class="line">    //specify control loop rate. We recommend a low frequency to not over load the FCU with messages. Too many messages will cause the drone to be sluggish</div><div class="line">    ros::Rate rate(2.0);</div><div class="line">    int counter = 0;</div><div class="line">    while(ros::ok())</div><div class="line">    {</div><div class="line">        ros::spinOnce();</div><div class="line">        rate.sleep();</div><div class="line">        if(check_waypoint_reached() == 1)</div><div class="line">        {</div><div class="line">            if (counter &lt; waypointList.size())</div><div class="line">            {</div><div class="line">                set_destination(waypointList[counter].x,waypointList[counter].y,waypointList[counter].z, waypointList[counter].psi);</div><div class="line">                counter++;  </div><div class="line">            }else{</div><div class="line">                //land after all waypoints are reached</div><div class="line">                land();</div><div class="line">            }   </div><div class="line">        }   </div><div class="line">        </div><div class="line">    }</div><div class="line">    return 0;</div><div class="line">}</div></div><!-- fragment --><p> ### run example code </p><div class="fragment"><div class="line">roslaunch mission8_sim droneOnly.launch</div><div class="line"># New Terminal</div><div class="line">~/catkin_ws/src/Mission8_OutOfControls/scripts/startsim.sh</div><div class="line"># New Terminal</div><div class="line">roslaunch out_of_controls apm.launch</div><div class="line"># New Terminal </div><div class="line">roslaunch out_of_controls contolAPIExample.launch</div></div><!-- fragment --><p> NOTE** you can tile gnome terminals by pressing <code>ctrl + shift + t</code> </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.16 </li>
  </ul>
</div>
</body>
</html>
