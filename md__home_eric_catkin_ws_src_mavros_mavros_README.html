<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Texas Aerial Robotics Documentation: MAVROS</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Texas Aerial Robotics Documentation
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__home_eric_catkin_ws_src_mavros_mavros_README.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">MAVROS </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>MAVLink extendable communication node for ROS with proxy for Ground Control Station (e.g. <a href="http://qgroundcontrol.org/">QGroundControl</a>).</p>
<p>ROS API documentation moved to <a href="http://wiki.ros.org/mavros">wiki.ros.org</a>.</p>
<h2>Features </h2>
<ul>
<li>Communication with autopilot via serial port, <a class="el" href="classUDP.html">UDP</a> or <a class="el" href="classTCP.html">TCP</a> (e.g. <a href="http://px4.io/">PX4 Pro</a> or <a href="http://ardupilot.com/">ArduPilot</a>)</li>
<li>Internal proxy for Ground Control Station (serial, <a class="el" href="classUDP.html">UDP</a>, <a class="el" href="classTCP.html">TCP</a>)</li>
<li>Plugin system for ROS-MAVLink translation</li>
<li>Parameter manipulation tool</li>
<li>Waypoint manipulation tool</li>
<li>PX4Flow support (by <a href="https://github.com/mavlink/mavros/tree/master/mavros_extras">mavros_extras</a>)</li>
<li>OFFBOARD mode support</li>
<li>Geographic coordinates conversions.</li>
</ul>
<h2>Limitations </h2>
<p>Only for Linux. Depends on <a href="http://www.boost.org/">Boost library</a>, GCC 4.8+ (C++11 support). Catkin build system required.</p>
<p>This package are dependent on <a href="http://wiki.ros.org/mavlink">ros-*-mavlink</a> build from <a href="https://github.com/mavlink/mavlink-gbp-release">mavlink-gbp-release</a>. It exists in ROS package index and usually updates each month.</p>
<h2>Connection URL </h2>
<p>Connection defined by URL, you can use any supported type for FCU and GCS.</p>
<p>Supported schemas:</p>
<ul>
<li>Serial: <code>/path/to/serial/device[:baudrate]</code></li>
<li>Serial: <code>serial:///path/to/serial/device[:baudrate][?ids=sysid,compid]</code></li>
<li>Serial with hardware flow control: <code>serial-hwfc:///path/to/serial/device[:baudrate][?ids=sysid,compid]</code></li>
<li><a class="el" href="classUDP.html">UDP</a>: <code>udp://[bind_host][:port]@[remote_host[:port]][/?ids=sysid,compid]</code></li>
<li><a class="el" href="classUDP.html">UDP</a> broadcast until GCS discovery: <code>udp-b://[bind_host][:port]@[:port][/?ids=sysid,compid]</code></li>
<li><a class="el" href="classUDP.html">UDP</a> broadcast (permanent): <code>udp-pb://[bind_host][:port]@[:port][/?ids=sysid,compid]</code></li>
<li><code><a class="el" href="classTCP.html">TCP</a> client:</code>tcp://[server_host][:port][/?ids=sysid,compid]<code></code></li>
<li><code><a class="el" href="classTCP.html">TCP</a> server:</code>tcp-l://[bind_host][:port][/?ids=sysid,compid]`</li>
</ul>
<p>Note:</p>
<ul>
<li>Ids from URL overrides value given by system_id &amp; component_id parameters.</li>
<li>bind_host - default <code>0.0.0.0</code> - i.e. IP4 ANY</li>
<li><a class="el" href="classUDP.html">UDP</a> default ports: 14555 @ 14550</li>
<li><a class="el" href="classUDP.html">UDP</a> remote address updated every time with incoming packet on bind port.</li>
<li><a class="el" href="classTCP.html">TCP</a> default port: 5760</li>
</ul>
<h2>Coordinate frames </h2>
<p>MAVROS does translate Aerospace NED frames, used in FCUs to ROS ENU frames and vice-versa. For translate airframe related data we simply apply rotation 180° about ROLL (X) axis. For local we apply 180° about ROLL (X) and 90° about YAW (Z) axes. Please read documents from issue #473 for additional information.</p>
<p>All the conversions are handled in <code><a class="el" href="ftf__frame__conversions_8cpp.html">src/lib/ftf_frame_conversions.cpp</a></code> and <code><a class="el" href="ftf__quaternion__utils_8cpp.html">src/lib/ftf_quaternion_utils.cpp</a></code> and tested in <code><a class="el" href="test__frame__conversions_8cpp.html">test/test_frame_conversions.cpp</a></code> and <code><a class="el" href="test__quaternion__utils_8cpp.html">test/test_quaternion_utils.cpp</a></code> respectively.</p>
<p>Related issues: <a href="https://github.com/mavlink/mavros/issues/49">#49 (outdated)</a>, <a href="https://github.com/mavlink/mavros/issues/216">#216 (outdated)</a>, <a href="https://github.com/mavlink/mavros/issues/317">#317 (outdated)</a>, <a href="https://github.com/mavlink/mavros/issues/319">#319 (outdated)</a>, <a href="https://github.com/mavlink/mavros/issues/321">#321 (outdated)</a>, <a href="https://github.com/mavlink/mavros/issues/473">#473</a>. Documents: <a href="https://docs.google.com/document/d/1bDhaozrUu9F915T58WGzZeOM-McyU20dwxX-NRum1KA/edit">Frame Conversions</a>, <a href="https://docs.google.com/spreadsheets/d/1LnsWTblU92J5_SMinTvBvHJWx6sqvzFa8SKbn8TXlnU/edit#gid=0">Mavlink coordinate frames</a>.</p>
<p>MAVROS also allows conversion of geodetic and geocentric coordinates through <a href="https://geographiclib.sourceforge.io/">GeographicLib</a> given that:</p><ul>
<li><code>geographic_msgs</code> and <code>NatSatFix.msg</code> require the LLA fields to be filled in WGS-84 datum, meaning that the altitude should be the height above the WGS-84 ellipsoid. For that, a conversion from the height above the geoid (AMSL, considering the egm96 geoid model) to height above the WGS-84 ellipsoid, and vice-versa, is available and used in several plugins;</li>
<li>According to ROS REP 105, the <code>earth</code> frame should be propagated in ECEF (Earth-Centered, Earth-Fixed) local coordinates. For that, the functionalities of GeographicLib are used in order to allow conversion from geodetic coordinates to geocentric coordinates;</li>
<li>The translation from GPS coordinates to local geocentric coordinates require the definition of a local origin on the <code>map</code> frame, in ECEF, and calculate the offset to it in ENU. All the conversions are supported by GeographicLib classes and methods and implemented in the <code>global_position</code> plugin.</li>
</ul>
<h2>Programs </h2>
<h3>mavros_node &ndash; main communication node</h3>
<p>Main node. Allow disable GCS proxy by setting empty URL.</p>
<p>Run example (autopilot connected via USB at 921600 baud, GCS running on the host with IP 172.16.254.1): </p><pre class="fragment">rosrun mavros mavros_node _fcu_url:=/dev/ttyACM0:921600 _gcs_url:=udp://@172.16.254.1
</pre><h3>gcs_bridge &ndash; additional proxy</h3>
<p>Allows you to add a channel for GCS. For example if you need to connect one GCS for HIL and the second on the tablet.</p>
<p>Example (SITL &amp; QGroundControl): </p><pre class="fragment">rosrun mavros mavros_node _gcs_url:='udp://:14556@172.16.254.129:14551' &amp;
rosrun mavros gcs_bridge _gcs_url:='udp://@172.16.254.129'
</pre><h2>Launch Files </h2>
<p>Launch files are provided for use with common FCUs, in particular [Pixhawk](pixhawk):</p>
<ul>
<li><a href="launch/px4.launch">px4.launch</a> &ndash; for use with the PX4 Pro flight stack (for VTOL, multicopters and planes)</li>
<li><a href="launch/apm.launch">apm.launch</a> &ndash; for use with APM flight stacks (e.g., all versions of ArduPlane, ArduCopter, etc)</li>
</ul>
<p>Examples: </p><pre class="fragment">roslaunch mavros px4.launch
roslaunch mavros apm.launch fcu_url:=tcp://localhost gcs_url:=udp://@
</pre><h2>Installation </h2>
<h3>Required dependencies</h3>
<p>Most of the ROS dependencies are supported and installed by <code>rosdep</code>, including external libraries as Eigen and Boost.</p>
<p><a href="https://geographiclib.sourceforge.io/">GeographicLib</a> can be installed by <code>apt-get</code> and it is already included on the rosdep of MAVROS package. It is also possible to compile it and install it from src but be advised to have the proper install directories the same as the ones of the <code>apt-get</code> install, in order to make sure that the <code>FindGeographicLib.cmake</code> finds the required shared libraries (<code>libGeographic.so</code>).</p>
<p>Since <b>GeographicLib requires certain datasets</b> (mainly the geoid dataset) so to fulfill certain calculations, these need to be installed manually by the user using <code>geographiclib-tools</code>, which can be installed by <code>apt-get</code> in Debian systems. For a quicker procedure, just <b>run the available script in the "mavros/scripts" folder, <code>install_geographiclib_datasets.sh</code></b>.</p>
<p>Note that if you are using an older MAVROS release source install and want to update to a new one, remember to run <code>rosdep update</code> before running <code>rosdep install --from-paths ${ROS_WORKSPACE} --ignore-src --rosdistro=${ROSDISTRO}</code>, with <code>ROS_WORKSPACE</code> your src folder of catkin workspace. This will allow updating the <code>rosdep</code> list and install the required dependencies when issuing <code>rosdep install</code>.</p>
<p>:bangbang: <b>The geoid dataset is mandatory to allow the conversion between heights in order to respect ROS msg API. Not having the dataset available will shutdown the <code>mavros_node</code></b> :bangbang:</p>
<p>:heavy_exclamation_mark:Run <code>install_geographiclib_datasets.sh</code> to install all datasets or <code>geographiclib-datasets-download egm96_5</code> (<em>Debian 7</em>, <em>Ubuntu 14.04</em>, <em>14.10</em>), <code>geographiclib-get-geoids egm96-5</code> (<em>Debian 8</em>, <em>Fedora 22</em>, <em>Ubuntu 15.04</em> or later) to install the geoid dataset only:heavy_exclamation_mark:</p>
<h3>Binary installation (deb)</h3>
<p>ROS repository has binary packages for Ubuntu x86, amd64 (x86_64) and armhf (ARMv7). Kinetic also support Debian Jessie amd64 and arm64 (ARMv8).</p>
<p>Just use <code>apt-get</code> for installation: </p><pre class="fragment">sudo apt-get install ros-kinetic-mavros ros-kinetic-mavros-extras
</pre><p>Then install GeographicLib datasets by running the <code>install_geographiclib_datasets.sh</code> script: </p><pre class="fragment">wget https://raw.githubusercontent.com/mavlink/mavros/master/mavros/scripts/install_geographiclib_datasets.sh
./install_geographiclib_datasets.sh
</pre><h3>Source installation</h3>
<p>Use <code>wstool</code> utility for retrieving sources and <a href="https://catkin-tools.readthedocs.org/en/latest/"><code>catkin</code> tool</a> for build.</p>
<p>NOTE: The source installation instructions are for the ROS Kinetic release.</p>
<div class="fragment"><div class="line">sudo apt-get install python-catkin-tools python-rosinstall-generator -y</div><div class="line"></div><div class="line"># 1. Create the workspace: unneded if you already has workspace</div><div class="line">mkdir -p ~/catkin_ws/src</div><div class="line">cd ~/catkin_ws</div><div class="line">catkin init</div><div class="line">wstool init src</div><div class="line"></div><div class="line"># 2. Install MAVLink</div><div class="line">#    we use the Kinetic reference for all ROS distros as it&#39;s not distro-specific and up to date</div><div class="line">rosinstall_generator --rosdistro kinetic mavlink | tee /tmp/mavros.rosinstall</div><div class="line"></div><div class="line"># 3. Install MAVROS: get source (upstream - released)</div><div class="line">rosinstall_generator --upstream mavros | tee -a /tmp/mavros.rosinstall</div><div class="line"># alternative: latest source</div><div class="line"># rosinstall_generator --upstream-development mavros | tee -a /tmp/mavros.rosinstall</div><div class="line"># For fetching all the dependencies into your catkin_ws, just add &#39;--deps&#39; to the above scripts</div><div class="line"># ex: rosinstall_generator --upstream mavros --deps | tee -a /tmp/mavros.rosinstall</div><div class="line"></div><div class="line"># 4. Create workspace &amp; deps</div><div class="line">wstool merge -t src /tmp/mavros.rosinstall</div><div class="line">wstool update -t src -j4</div><div class="line">rosdep install --from-paths src --ignore-src -y</div><div class="line"></div><div class="line"># 5. Install GeographicLib datasets:</div><div class="line">./src/mavros/mavros/scripts/install_geographiclib_datasets.sh</div><div class="line"></div><div class="line"># 6. Build source</div><div class="line">catkin build</div><div class="line"></div><div class="line"># 7. Make sure that you use setup.bash or setup.zsh from workspace.</div><div class="line">#    Else rosrun can&#39;t find nodes from this workspace.</div><div class="line">source devel/setup.bash</div></div><!-- fragment --><p><em>Build error</em>. if you has error with missing <code>mavlink*</code> then you need fresh mavlink package. You may update from <a href="http://packages.ros.org/ros-shadow-fixed/ubuntu/pool/main/r/ros-jade-mavlink/">ros-shadow-fixed</a> (binary installation) or redo script steps 2 &amp; 4.</p>
<p><em>Note</em>. Since MAVLink 2.0 merged (0.18) all dialects supported by same binary. Unfortunately overlap of v1.0 message ID's not fully handled, first loaded message forbid further changes. Load order always:</p>
<ol type="1">
<li>common</li>
<li>ardupilotmega</li>
<li>alphabetical ordered list</li>
<li>...</li>
</ol>
<p><em>Note</em>: <code>MAVLINK_DIALECT</code> not used anymore.</p>
<h2>Troubleshooting </h2>
<h3>Error: serial0: receive: End of file</h3>
<p>This issue should have been solve in mavros v0.23.2, it was found to be a Boost.ASIO error and should be fix in release &gt; v1.12.0 ( &gt;Boost 1.66).</p>
<h2>Contributing </h2>
<p>See CONTRIBUTING.md.</p>
<h2>Glossary </h2>
<ul>
<li><em>GCS</em> — Ground Control Station</li>
<li><em>FCU</em> — Flight Control Unit (aka <em>FC</em>)</li>
<li><em>OBC</em> — OnBoard Computer (your odroid or raspberry)</li>
</ul>
<h2>Links </h2>
<ul>
<li><a href="http://mavlink.org/mavlink/start">MAVLink</a> &ndash; communication protocol</li>
<li><a href="https://github.com/mavlink/mavlink_ros">mavlink_ros</a> &ndash; original ROS node (few messages, no proxy)</li>
<li><a href="http://pixhawk.org/">Pixhawk</a> &ndash; Reference hardware platform</li>
<li><a href="http://px4.io/">PX4</a> &ndash; Reference implementation in the academic community</li>
<li><a href="http://ardupilot.com/">ArduPilot</a> &ndash; tested autopilot APM:Plane (default command set)</li>
<li><a href="http://qgroundcontrol.org/">QGroundControl</a> &ndash; tested ground control station for Android, iOS, Mac OS, Linux and Windows</li>
<li><a href="https://github.com/mavlink/mavros/tree/master/mavros_extras">mavros_extras</a> &ndash; extra plugins &amp; node for mavros </li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.16 </li>
  </ul>
</div>
</body>
</html>
